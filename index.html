<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order App</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
    }
    button {
      margin: 5px;
    }
    input {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>Order App</h1>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const { useState, useRef } = React;

    function OrderApp() {
      const defaultItems = [
        { id: 1, name: "Cream jehi Banas" },
        { id: 2, name: "Bis Bajiyaa" },
        { id: 3, name: "Bis Cutlets" },
        { id: 4, name: "Foni Folhi" },
        { id: 5, name: "Rose Paan" },
        { id: 6, name: "Boiled Egg" },
        { id: 7, name: "Dhon Kajuru" },
        { id: 8, name: "Masroshi" },
        { id: 9, name: "Gulha" }
      ];

      const [items, setItems] = useState(defaultItems);
      const [people, setPeople] = useState([]);
      const [newItemName, setNewItemName] = useState("");
      const [showPreview, setShowPreview] = useState(false);
      const orderRef = useRef(null);

      function addPerson() {
        setPeople([...people, { name: 'Person ' + (people.length + 1), orders: [] }]);
      }

      function renamePerson(i, name) {
        const updated = [...people];
        updated[i].name = name;
        setPeople(updated);
      }

      function addItem(i, id) {
        const updated = [...people];
        updated[i].orders.push(id);
        setPeople(updated);
      }

      function resetOrder(i) {
        const updated = [...people];
        updated[i].orders = [];
        setPeople(updated);
      }

      function getTotal(id) {
        return people.reduce((sum, p) => sum + p.orders.filter(x => x === id).length, 0);
      }

      function addNewItem() {
        if (newItemName.trim()) {
          setItems([...items, { id: Date.now(), name: newItemName }]);
          setNewItemName("");
        }
      }

      function deleteItem(id) {
        setItems(items.filter(x => x.id !== id));
        setPeople(people.map(p => ({
          ...p,
          orders: p.orders.filter(i => i !== id)
        })));
      }

      function saveAsImage() {
        if (orderRef.current) {
          html2canvas(orderRef.current).then(canvas => {
            const link = document.createElement('a');
            link.download = 'order-summary.png';
            link.href = canvas.toDataURL();
            link.click();
          });
        }
      }

      return React.createElement('div', null,
        React.createElement('input', {
          value: newItemName,
          onChange: e => setNewItemName(e.target.value),
          placeholder: 'Add item'
        }),
        React.createElement('button', { onClick: addNewItem }, 'Add Item'),
        items.map(item =>
          React.createElement('div', { key: item.id, className: 'card' },
            React.createElement('b', null, item.name + ' - Total: ' + getTotal(item.id)),
            React.createElement('button', { onClick: () => deleteItem(item.id) }, 'Delete')
          )
        ),
        React.createElement('button', { onClick: addPerson }, 'Add Person'),
        people.map((p, i) =>
          React.createElement('div', { key: i, className: 'card' },
            React.createElement('input', {
              value: p.name,
              onChange: e => renamePerson(i, e.target.value)
            }),
            items.map(item =>
              React.createElement('button', {
                key: item.id,
                onClick: () => addItem(i, item.id)
              }, item.name)
            ),
            React.createElement('div', null, 'Orders: ' +
              p.orders.map(id => items.find(x => x.id === id)?.name).join(', ')
            ),
            React.createElement('button', { onClick: () => resetOrder(i) }, 'Reset')
          )
        ),
        people.length > 0 && React.createElement('div', null,
          React.createElement('button', { onClick: () => setShowPreview(true) }, 'Show Preview'),
          React.createElement('button', { onClick: saveAsImage }, 'Save as Image')
        ),
        showPreview && React.createElement('div', { ref: orderRef },
          React.createElement('h3', null, 'Order Summary'),
          items.filter(x => getTotal(x.id) > 0).map(item =>
            React.createElement('div', { key: item.id },
              item.name + ': ' + getTotal(item.id)
            )
          ),
          people.map((p, i) =>
            React.createElement('div', { key: i },
              React.createElement('b', null, p.name + ': '),
              p.orders.map(id => items.find(x => x.id === id)?.name).join(', ')
            )
          )
        )
      );
    }

    ReactDOM.render(
      React.createElement(OrderApp),
      document.getElementById('root')
    );
  </script>
</body>
</html>
