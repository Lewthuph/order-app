<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order App</title>
  <!-- Tailwind via CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-50">
  <h1 class="text-3xl font-bold mb-6 text-center">Order App</h1>
  <div id="root"></div>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- html2canvas for “save as image” -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const { useState, useRef } = React;

    function OrderApp() {
      const defaultItems = [
        { id: 1, name: "Cream jehi Banas" },
        { id: 2, name: "Bis Bajiyaa" },
        { id: 3, name: "Bis Cutlets" },
        { id: 4, name: "Foni Folhi" },
        { id: 5, name: "Rose Paan" },
        { id: 6, name: "Boiled Egg" },
        { id: 7, name: "Dhon Kajuru" },
        { id: 8, name: "Masroshi" },
        { id: 9, name: "Gulha" }
      ];

      const [items, setItems] = useState(defaultItems);
      const [people, setPeople] = useState([]);
      const [newItemName, setNewItemName] = useState("");
      const [showPreview, setShowPreview] = useState(false);
      const orderRef = useRef(null);

      const addPerson = () => setPeople([...people, { name: `Person ${people.length + 1}`, orders: [] }]);
      const renamePerson = (i, n) => {
        const c = [...people]; c[i].name = n; setPeople(c);
      };
      const addItem = (i, id) => {
        const c = [...people]; c[i].orders.push(id); setPeople(c);
      };
      const reset = i => {
        const c = [...people]; c[i].orders = []; setPeople(c);
      };
      const total = id => people.reduce((s,p) => s + p.orders.filter(x => x === id).length, 0);

      const addNew = () => {
        if (newItemName.trim()) {
          setItems([...items, { id: Date.now(), name: newItemName }]);
          setNewItemName("");
        }
      };
      const del = id => {
        setItems(items.filter(x => x.id !== id));
        setPeople(people.map(p => ({ ...p, orders: p.orders.filter(x => x !== id) })));
      };
      const saveImg = () => {
        if (orderRef.current) {
          html2canvas(orderRef.current).then(c => {
            const link = document.createElement('a');
            link.download = 'orders.png';
            link.href = c.toDataURL();
            link.click();
          });
        }
      };

      return React.createElement('div', { className: 'space-y-4' },
        // Add item input
        React.createElement('div', null,
          React.createElement('input', {
            className: 'border p-2 rounded mr-2',
            placeholder: 'Add item',
            value: newItemName,
            onChange: e => setNewItemName(e.target.value)
          }),
          React.createElement('button', { className: 'bg-blue-600 text-white px-4 py-2 rounded', onClick: addNew }, 'Add Item')
        ),
        // List items with counts
        items.map(item =>
          React.createElement('div', {
            key: item.id,
            className: 'p-4 bg-white rounded shadow flex justify-between items-center'
          },
            React.createElement('span', null, `${item.name} (${total(item.id)})`),
            React.createElement('button', { className: 'text-red-500', onClick: () => del(item.id) }, 'Delete')
          )
        ),
        // Add person button
        React.createElement('button', { className: 'bg-green-600 text-white px-4 py-2 rounded', onClick: addPerson }, 'Add Person'),
        // Person cards
        people.map((p, i) =>
          React.createElement('div', { key: i, className: 'p-4 bg-white rounded shadow space-y-2' },
            React.createElement('input', {
              className: 'border p-2 rounded w-full',
              value: p.name,
              onChange: e => renamePerson(i, e.target.value)
            }),
            React.createElement('div', { className: 'flex flex-wrap gap-2' },
              items.map(it =>
                React.createElement('button', {
                  key: it.id,
                  className: 'border px-3 py-1 rounded',
                  onClick: () => addItem(i, it.id)
                }, it.name)
              )
            ),
            React.createElement('div', null, 'Orders: ' + p.orders.map(id => items.find(x => x.id === id)?.name).join(', ')),
            React.createElement('button', { className: 'text-gray-600', onClick: () => reset(i) }, 'Reset')
          )
        ),
        // Preview / save buttons
        people.length > 0 && React.createElement('div', { className: 'space-x-2' },
          React.createElement('button', { className: 'bg-yellow-500 text-white px-4 py-2 rounded', onClick: () => setShowPreview(true) }, 'Show Preview'),
          React.createElement('button', { className: 'bg-indigo-500 text-white px-4 py-2 rounded', onClick: saveImg }, 'Save Image')
        ),
        // Preview panel
        showPreview && React.createElement('div', { ref: orderRef, className: 'p-4 bg-white rounded shadow mt-4' },
          React.createElement('h3', { className: 'font-bold mb-2' }, 'Order Summary'),
          items.filter(x => total(x.id) > 0).map(x =>
            React.createElement('div', { key: x.id }, `${x.name}: ${total(x.id)}`)
          ),
          people.map((p, i) =>
            React.createElement('div', { key: i },
              `${p.name}: ${p.orders.map(id => items.find(x => x.id === id)?.name).join(', ')}`
            )
          )
        )
      );
    }

    // Render into the page
    ReactDOM.render(React.createElement(OrderApp), document.getElementById('root'));
  </script>
</body>
</html>
